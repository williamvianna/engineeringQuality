name: ğŸ“ˆ CI - Testes de Carga com JMeter

on:
  push:
    branches: [ main ]
    paths:
      # Roda a pipeline somente se houver mudanÃ§as na pasta 'jmeter' ou no prÃ³prio workflow
      - 'jmeter/**'
      - '.github/workflows/jmeter_ci.yml'

jobs:
  run_jmeter_tests:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout do CÃ³digo
        uses: actions/checkout@v4

      - name: â˜• Configurar Java (v17)
        # JMeter Ã© uma aplicaÃ§Ã£o Java e requer o JDK
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: ğŸ“¦ Instalar JMeter CLI
        # Instala o Apache JMeter no runner (pode ser lento)
        run: sudo apt-get update && sudo apt-get install -y jmeter

      - name: ğŸƒ Rodar Teste de Performance (JMeter Non-GUI)
        # Executa o teste de carga no modo non-GUI (-n), define o arquivo de log (-l)
        # Substitua 'smoke_test.jmx' pelo nome do seu arquivo principal.
        run: jmeter -n -t smoke_test.jmx -l results.jtl || true
        working-directory: jmeter
        
      - name: â¬†ï¸ Publicar RelatÃ³rio JTL
        # Opcional, mas Ãºtil: salva o arquivo de resultados para anÃ¡lise posterior
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: jmeter-jtl-results
          path: jmeter/results.jtl