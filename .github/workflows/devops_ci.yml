name: âš™ï¸ CI - Scripts e IaC de DevOps (Terraform/Shell)

on:
  push:
    branches: [ main ]
    paths:
      # Roda a pipeline somente se houver mudanÃ§as na pasta 'devops' ou no prÃ³prio workflow
      - 'devops/**'
      - '.github/workflows/devops_ci.yml'

jobs:
  validate_devops_code:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout do CÃ³digo
        uses: actions/checkout@v4

      # -- 1. ValidaÃ§Ã£o de IaC (Terraform) --
      - name: ğŸ› ï¸ Setup Terraform CLI
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 'latest' # Configura a CLI do Terraform

      - name: ğŸ” Terraform Format Check
        # Garante que os arquivos .tf estejam formatados corretamente
        run: terraform fmt -check -recursive
        working-directory: devops/terraform # Ajuste o caminho se seu cÃ³digo .tf estiver em outra subpasta

      - name: ğŸ”¬ Terraform Validation
        # Inicializa e valida a sintaxe dos arquivos .tf (nÃ£o faz deploy)
        run: |
          terraform init
          terraform validate
        working-directory: devops/terraform

      # -- 2. ValidaÃ§Ã£o de Scripts (Exemplo Shell) --
      - name: ğŸ“œ Shell Script Check
        # Um passo para garantir que shell scripts na pasta sejam executÃ¡veis ou lintados
        run: |
          echo "Simulando linting de scripts shell ou Ansible playbooks..."
          # Exemplo: shfmt -l devops/scripts/*.sh
        working-directory: devops